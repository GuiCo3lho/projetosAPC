typedef struct
{
    int Codigodoveiculo;
    char Carro[16];
    char Marca[16];
    int AnoFabricacao;
    int AnoModelo;
    char Cor[16];
    int Km;
    char ArCond;
    char DirecaoHidraulica;
    float Preco;
    char Datadecaentrada[10];
}infocarro;

#include<stdio.h>
#include <stdlib.h>
#include<string.h>

#ifdef_WIN64
    #define CLEAR "cls"
#else
    #define CLEAR "clear"
#endif

void buscaCodigo(infocarro a)
{
    int codigo;
    FILE *fp;
    
    fp=fopen("VEICULOS.bin","rb");
    
    printf("Digite o codigo do veiculo");
    scanf("%d",&codigo);
    
    fread(&a,sizeof(infocarro),1,fp);
    
    if(codigo == a.Codigodoveiculo)
    {
        while(fread(&a,sizeof(infocarro),1,fp)!=0)
        {
            printf("%d\n",a.Codigodoveiculo);
            printf("%s",a.Carro);
            printf("%s",a.Marca);
            printf(a.AnoFabricacao);
            printf(a.AnoModelo);
            printf(a.Cor);
            printf(a.Km);
            printf(a.ArCond);
            printf(a.DirecaoHidraulica);
            printf(a.Preco);
            printf(a.Datadecaentrada);
        }
        
    
}

void cadastroCarro(infocarro a)
{
    char op, str[]="VEICULOS.bin";
    FILE *fp;
    fp=fopen(str,"wb");
    do
    {

        system (CLEAR);
        printf("Qual o codigo do veiculo?\n");
        scanf("%d", &a.Codigodoveiculo);
        getchar();
        printf("Qual o nome do veiculo?\n");
        scanf("%s", a.Carro);
        getchar();
        printf("Qual a marca do veiculo?\n");
        scanf("%s", a.Marca);
        printf("Qual o ano de fabricacao do veiculo?\n");
        scanf("%d", &a.AnoFabricacao);
        printf("Qual o ano do modelo do veiculo?\n");
        scanf("%d", &a.AnoModelo);
        getchar();
        printf("Qual a cor do veiculo?\n");
        scanf("%s", a.Cor);
        printf("Quantos km rodados tem o veiculo?\n");
        scanf("%d", &a.Km);
        getchar();
        printf("O veiculo tem ar-condicionado? -S=SIM,N=NAO-\n");
        scanf("%c", &a.ArCond);
        getchar();
        printf("O veiculo tem direcao-hidraulica? -S=SIM,N=NAO-\n");
        scanf("%c", &a.DirecaoHidraulica);
        printf("Qual o preco do veiculo?\n");
        scanf("%f", &a.Preco);
        getchar();
        printf("Qual a data do cadastro/entrada? No formato DD/MM/AA.\n");
        scanf("%s", a.Datadecaentrada);
        getchar();
        printf("Deseja incluir um novo veiculo?\nS - SIM\nN - NAO\n");
        scanf("%c",&op);
        fwrite(&a,sizeof(infocarro),1,fp);

        if(op!='N' && op!='S')
        {
            do
            {
                getchar();
                printf("ERRO: Opcao invalida!\nDeseja incluir um novo veiculo?\nS - SIM\nN - NAO\n");
                scanf("%c",&op);
            }while(op!='N' && op!='S');
        }
    }while(op=='S');
    fclose(fp);
}

void novocadastroCarro(infocarro a)
{
    char op, str[]="VEICULOS.bin";
    FILE *fp;
    fp=fopen(str,"r+b");

    if(fp==NULL)
    {
        printf("O cadastro atual nao possui dados!\n");
        fp=fopen(str,"wb");
    }
    else
    {
        fclose(fp);
        fopen(str,"ab");
    }

    do
    {

        system (CLEAR);
        printf("Qual o codigo do veiculo?\n");
        scanf("%d", &a.Codigodoveiculo);
        getchar();
        printf("Qual o nome do veiculo?\n");
        scanf("%s", a.Carro);
        getchar();
        printf("Qual a marca do veiculo?\n");
        scanf("%s", a.Marca);
        printf("Qual o ano de fabricacao do veiculo?\n");
        scanf("%d", &a.AnoFabricacao);
        printf("Qual o ano do modelo do veiculo?\n");
        scanf("%d", &a.AnoModelo);
        getchar();
        printf("Qual a cor do veiculo?\n");
        scanf("%s", a.Cor);
        printf("Quantos km rodados tem o veiculo?\n");
        scanf("%d", &a.Km);
        getchar();
        printf("O veiculo tem ar-condicionado? -S=SIM,N=NAO-\n");
        scanf("%c", &a.ArCond);
        getchar();
        printf("O veiculo tem direcao-hidraulica? -S=SIM,N=NAO-\n");
        scanf("%c", &a.DirecaoHidraulica);
        printf("Qual o preco do veiculo?\n");
        scanf("%f", &a.Preco);
        getchar();
        printf("Qual a data do cadastro/entrada? No formato DD/MM/AA.\n");
        scanf("%s", a.Datadecaentrada);
        getchar();
        printf("Deseja incluir um novo veiculo?\nS - SIM\nN - NAO\n");
        scanf("%c",&op);
        fwrite(&a,sizeof(infocarro),1,fp);

        if(op!='N' && op!='S')
        {
            do
            {
                getchar();
                printf("ERRO: Opcao invalida!\nDeseja incluir um novo veiculo?\nS - SIM\nN - NAO\n");
                scanf("%c",&op);
            }while(op!='N' && op!='S');
        }
    }while(op=='S');
    fclose(fp);
}

int main()
{
    infocarro a;
    int escolha;

    do
    {
        system (CLEAR);
        printf("1. CRIAR E INICIAR CADASTRO NOVO\n"
               "2. INCLUIR DADOS NO CADASTRO EXISTENTE\n"
               "3. CONSULTAR O CADASTRO POR CODIGO DE VEICULO\n"
               "4. CONSULTAR O CADASTRO POR CATEGORIA E ANO DO MODELO\n"
               "5. GERAR ARQUIVO TXT DOS VEICULOS 0 KM\n"
               "6. SAIR\n");

        scanf("%d",&escolha);
        while((escolha < 1) && (escolha > 6))
        {
            printf("Opcao invalida\n");
            scanf("%d", &escolha);
        }

        switch(escolha)
        {
            case 1:
                cadastroCarro(a);
            break;
            case 2:
                novocadastroCarro(a);
            break;
            case 3:
                buscaCodigo();
            break;
            case 4
            break;
            case 5
            break;*/
            case 6:
            default:
                break;
        }
    }while(escolha!=6);

    return 0;
}
